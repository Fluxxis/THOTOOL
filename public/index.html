<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tools Hub</title>
  <style>
    :root{
      --bg:#000; --fg:#fff;
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.55);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:var(--mono);overflow-x:hidden}
    .bgNoise{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.18;
      background:repeating-linear-gradient(to bottom, rgba(255,255,255,.05) 0px, rgba(255,255,255,.05) 1px, transparent 2px, transparent 6px);
      animation:scan 7s linear infinite}
    @keyframes scan{0%{transform:translateY(0)}100%{transform:translateY(24px)}}

    .hidden{display:none !important;}

    .gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#000;z-index:60;padding:18px}
    .gateInner{max-width:780px;width:100%;border:1px solid rgba(255,255,255,.22);padding:16px}
    .gateTitle{font-size:12px;letter-spacing:.8px;text-transform:uppercase;color:rgba(255,255,255,.92)}
    .langRow{margin-top:14px;display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width: 720px){ .langRow{grid-template-columns:1fr 1fr 1fr;} }
    .langBtn{
      border:1px solid rgba(255,255,255,.20);
      background:#000;
      color:#fff;
      padding:12px;
      cursor:pointer;
      font-family:var(--mono);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      transition: transform .12s ease, border-color .12s ease;
      user-select:none;
    }
    .langBtn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.45);}
    .langBtn img{width:160px;height:100px;object-fit:cover;border:1px solid rgba(255,255,255,.16)}
    .langBtn .l{font-size:12px;letter-spacing:.6px;text-transform:uppercase;color:rgba(255,255,255,.92)}
    .gateHint{margin-top:12px;font-size:11px;color:rgba(255,255,255,.55);line-height:1.4}

    .gateLoadBox{margin-top:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px}
    .gateLoadBox img{width:120px;height:120px;filter:grayscale(1) contrast(1.15);opacity:.95;image-rendering:pixelated}
    .gateLoadBox .t{font-size:12px;color:var(--muted);letter-spacing:.4px;text-transform:uppercase;animation:flicker 1.2s infinite steps(2,end)}
    @keyframes flicker{0%,49%{opacity:1}50%,100%{opacity:.5}}

    .wrap{position:relative;z-index:1;max-width:1040px;margin:0 auto;padding:18px 14px 44px;display:flex;flex-direction:column;min-height:100%;gap:14px}
    .brand{text-align:center;margin-top: 10px;}
    .brand .h{font-size:18px;letter-spacing:1px;text-transform:uppercase;margin:0}
    .brand .s{margin-top:6px;font-size:12px;color:var(--muted2);line-height:1.4;max-width:860px; margin-inline:auto}

    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top: 10px;}
    @media (min-width: 860px){ .grid{grid-template-columns:1fr 1fr;} }

    .card{
      border:1px solid rgba(255,255,255,.20);
      padding:12px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
      background:#000;
    }
    .card:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.45);}
    .card .name{font-size:12px;letter-spacing:.6px;text-transform:uppercase;color:rgba(255,255,255,.92)}

    .panel{
      border:1px solid rgba(255,255,255,.22);
      padding:12px;
      margin-top: 14px;
      display:none;
    }
    .panel.open{display:block}
    .panelTop{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .panelTitle{font-size:12px;letter-spacing:.6px;text-transform:uppercase}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .btn{
      padding:10px 12px;
      font-family:var(--mono);
      font-size:12px;
      cursor:pointer;
      border:1px solid #fff;
      background:#fff;
      color:#000;
      user-select:none;
    }
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn.secondary{background:#000;color:#fff;border:1px solid rgba(255,255,255,.35)}
    .btn:disabled{opacity:.6; cursor:not-allowed;}
    .fieldRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .input{
      flex:1 1 280px;
      background:#000;
      color:#fff;
      border:1px solid rgba(255,255,255,.25);
      padding:10px 10px;
      font-family:var(--mono);
      font-size:12px;
      outline:none;
    }
    .input:focus{border-color:rgba(255,255,255,.70)}
    .out{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.20);
      padding:12px;
      font-size:12px;
      line-height:1.45;
      white-space:pre-wrap;
      overflow:auto;
      max-height: 46vh;
    }
    .out img.qr{
      display:block;
      width:min(220px, 78vw);
      height:auto;
      border:1px solid rgba(255,255,255,.22);
      margin-bottom:10px;
      image-rendering:auto;
    }
    a{color:#fff; text-decoration: underline; text-underline-offset: 3px}
  
    /* Pretty results */
    .out{white-space:normal; word-break:break-word;}
    .resultBox{border:1px solid rgba(255,255,255,.20); padding:12px;}
    .resultTop{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px;}
    .badge{display:inline-flex; align-items:center; justify-content:center; padding:4px 8px; border:1px solid rgba(255,255,255,.35); font-size:11px; text-transform:uppercase; letter-spacing:.6px;}
    .badge.ok{background:#fff; color:#000; border-color:#fff;}
    .badge.bad{background:#000; color:#fff;}
    .resultTool{font-size:12px; color:rgba(255,255,255,.92); letter-spacing:.4px;}
    .rows{display:flex; flex-direction:column; gap:8px;}
    .row{display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap;}
    .k{min-width:140px; color:rgba(255,255,255,.55); font-size:11px; text-transform:uppercase; letter-spacing:.6px;}
    .v{flex:1 1 300px; font-size:12px; color:rgba(255,255,255,.92);}
    .pill{display:inline-flex; align-items:center; justify-content:center; padding:2px 8px; border:1px solid rgba(255,255,255,.28); font-size:11px; margin-right:8px; margin-bottom:6px;}
    .pill.ok{background:#fff; color:#000; border-color:#fff;}
    .pill.bad{background:#000; color:#fff;}
    .list{border:1px solid rgba(255,255,255,.18); padding:10px; display:flex; flex-direction:column; gap:6px;}
    .item{display:flex; gap:10px; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,.10); padding-bottom:6px;}
    .item:last-child{border-bottom:none; padding-bottom:0;}
    .code{font-family:var(--mono); font-size:12px; color:#fff; overflow:auto;}
    .miniBtn{padding:6px 10px; font-family:var(--mono); font-size:11px; cursor:pointer; border:1px solid rgba(255,255,255,.35); background:#000; color:#fff;}
    .miniBtn:hover{border-color:rgba(255,255,255,.60);}
    details.raw{margin-top:10px; border-top:1px solid rgba(255,255,255,.16); padding-top:10px;}
    details.raw summary{cursor:pointer; color:rgba(255,255,255,.72); font-size:11px; text-transform:uppercase; letter-spacing:.6px;}
    details.raw pre{margin:10px 0 0; white-space:pre; overflow:auto; max-height:34vh; border:1px solid rgba(255,255,255,.12); padding:10px;}
    .loadingRow{display:flex; align-items:center; gap:10px; color:rgba(255,255,255,.72); font-size:12px;}
    .loadingGif{width:18px; height:18px; image-rendering:auto; border:1px solid rgba(255,255,255,.18);}
    table.kv{width:100%; border-collapse:collapse; font-size:12px;}
    table.kv td{border-bottom:1px solid rgba(255,255,255,.12); padding:6px 0; vertical-align:top;}
    table.kv td:first-child{color:rgba(255,255,255,.55); font-size:11px; text-transform:uppercase; letter-spacing:.6px; width:180px; padding-right:12px;}

  
    .seg{display:flex; width:max-content; border:1px solid rgba(255,255,255,.35); overflow:hidden; margin-top:10px}
    .segBtn{background:#000; color:#fff; border:0; border-right:1px solid rgba(255,255,255,.35); padding:10px 12px; font-family:var(--mono); font-size:12px; cursor:pointer}
    .segBtn:last-child{border-right:0}
    .segBtn.active{background:#fff; color:#000}
</style>
</head>
<body>
  <div class="bgNoise"></div>

  <div class="gate" id="gate">
    <div class="gateInner" id="gatePick">
      <div class="gateTitle" id="gateTitle">–í—ã–±–µ—Ä–∏ —è–∑—ã–∫</div>
      <div class="langRow">
        <button class="langBtn" data-lang="uk" type="button">
          <img data-asset="flag_ua.gif" alt="ua">
          <div class="l">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</div>
        </button>
        <button class="langBtn" data-lang="ru" type="button">
          <img data-asset="flag_ru.gif" alt="ru">
          <div class="l">–†—É—Å—Å–∫–∏–π</div>
        </button>
        <button class="langBtn" data-lang="en" type="button">
          <img data-asset="flag_en.gif" alt="en">
          <div class="l">English</div>
        </button>
      </div>
      <div class="gateHint" id="gateHint"></div>
    </div>

    <div class="gateInner hidden" id="gateLoad">
      <div class="gateLoadBox">
        <img data-asset="loading.gif" alt="loading">
        <div class="t" id="gateLoadTitle">Loading...</div>
        <div class="gateHint" id="gateLoadHint"></div>
      </div>
    </div>
  </div>

  <div class="wrap hidden" id="wrap">
    <div class="brand">
      <p class="h" id="brandTitle">Tools Hub</p>
      <div class="s" id="brandSub"></div>
    </div>

    <div class="grid" id="cards"></div>

    <div class="panel" id="panel">
      <div class="panelTop">
        <div class="panelTitle" id="panelTitle">Tool</div>
        <div class="btnRow">
          <button class="btn secondary" id="btnHome">–ó–∞–∫—Ä—ã—Ç—å</button>
          <button class="btn" id="btnRun">Run</button>
        </div>
      </div>

      <div class="fieldRow" id="fields"></div>
      <div class="out" id="out"></div>
    </div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);
  const cardsEl = $("cards");
  const panel = $("panel");
  const panelTitle = $("panelTitle");
  const fieldsEl = $("fields");
  const outEl = $("out");
  const btnHome = $("btnHome");
  const btnRun = $("btnRun");
  const gate = $("gate");
  const wrap = $("wrap");
  const brandTitle = $("brandTitle");
  const brandSub = $("brandSub");
  const gateTitle = $("gateTitle");
  const gateHint = $("gateHint");
  const gatePick = $("gatePick");
  const gateLoad = $("gateLoad");
  const gateLoadTitle = $("gateLoadTitle");
  const gateLoadHint = $("gateLoadHint");

  let current = null;
  let LANG = "ru";

  // Asset paths:
  function assetCandidates(name){
    if(location.protocol === "file:") return [`public/${name}`];
    return [`/${name}`, `/public/${name}`, `public/${name}`];
  }
  function setAssetImg(img, name){
    const cand = assetCandidates(name);
    let i = 0;
    const next = ()=>{
      i++;
      if(i < cand.length) img.src = cand[i];
    };
    img.onerror = next;
    img.src = cand[0];
  }

  const UI = {
    ru: {
      gateTitle: "–í—ã–±–µ—Ä–∏ —è–∑—ã–∫",
      gateHint: "",
      brandTitle: "Tools Hub",
      brandSub: "",
      close: "–ó–∞–∫—Ä—ã—Ç—å",
      running: "–≤—ã–ø–æ–ª–Ω—è—é...",
      openMap: "–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É",
      error: "–û—à–∏–±–∫–∞",
      success: "–ì–æ—Ç–æ–≤–æ",
      fail: "–û—à–∏–±–∫–∞",
      raw: "Raw JSON",
      copy: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
      copied: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ",
      loading: "–ó–∞–≥—Ä—É–∂–∞—é..."
    },
    uk: {
      gateTitle: "–û–±–µ—Ä–∏ –º–æ–≤—É",
      gateHint: "",
      brandTitle: "Tools Hub",
      brandSub: "",
      close: "–ó–∞–∫—Ä–∏—Ç–∏",
      running: "–≤–∏–∫–æ–Ω—É—é...",
      openMap: "–í—ñ–¥–∫—Ä–∏—Ç–∏ –º–∞–ø—É",
      error: "–ü–æ–º–∏–ª–∫–∞",
      success: "–ì–æ—Ç–æ–≤–æ",
      fail: "–ü–æ–º–∏–ª–∫–∞",
      raw: "Raw JSON",
      copy: "–ö–æ–ø—ñ—é–≤–∞—Ç–∏",
      copied: "–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ",
      loading: "–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é..."
    },
    en: {
      gateTitle: "Choose language",
      gateHint: "",
      brandTitle: "Tools Hub",
      brandSub: "",
      close: "Close",
      running: "running...",
      openMap: "Open map",
      error: "Error",
      success: "Done",
      fail: "Error",
      raw: "Raw JSON",
      copy: "Copy",
      copied: "Copied",
      loading: "Loading..."
    }
  };

  const tools = [
    {
      id:"ip",
      name:{ru:"IP Lookup", uk:"IP Lookup", en:"IP Lookup"},
      action:{ru:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP", uk:"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ IP", en:"Check IP"},
      fields:[{k:"ip", ph:{ru:"IP (–ø—É—Å—Ç–æ = –º–æ–π IP)", uk:"IP (–ø–æ—Ä–æ–∂–Ω—å–æ = –º—ñ–π IP)", en:"IP (empty = my IP)"}}],
      run: async (v)=> apiJson(`/api/ip?ip=${encodeURIComponent(v.ip||"")}&lang=${encodeURIComponent(LANG)}`)
    },
    {
      id:"geo",
      name:{ru:"IP Geolocation Map", uk:"IP Geolocation Map", en:"IP Geolocation Map"},
      action:{ru:"–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É", uk:"–ü–æ–∫–∞–∑–∞—Ç–∏ –º–∞–ø—É", en:"Show map"},
      fields:[{k:"ip", ph:{ru:"IP (–ø—É—Å—Ç–æ = –º–æ–π IP)", uk:"IP (–ø–æ—Ä–æ–∂–Ω—å–æ = –º—ñ–π IP)", en:"IP (empty = my IP)"}}],
      run: async (v)=> {
        const r = await apiJson(`/api/ip?ip=${encodeURIComponent(v.ip||"")}&lang=${encodeURIComponent(LANG)}`);
        const d = r.data || {};
        const lat = d.latitude, lon = d.longitude;
        if (lat && lon) r.map = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=12/${lat}/${lon}`;
        return r;
      }
    },
    {
      id:"whois",
      name:{ru:"WHOIS Lookup", uk:"WHOIS Lookup", en:"WHOIS Lookup"},
      action:{ru:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WHOIS", uk:"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ WHOIS", en:"Check WHOIS"},
      fields:[{k:"domain", ph:{ru:"domain.com", uk:"domain.com", en:"domain.com"}}],
      run: async (v)=> apiJson(`/api/whois?domain=${encodeURIComponent(v.domain||"")}`)
    },
    {
      id:"headers",
      name:{ru:"HTTP Header Check", uk:"HTTP Header Check", en:"HTTP Header Check"},
      action:{ru:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏", uk:"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏", en:"Check headers"},
      fields:[{k:"url", ph:{ru:"https://example.com", uk:"https://example.com", en:"https://example.com"}}],
      run: async (v)=> apiJson(`/api/headers?url=${encodeURIComponent(v.url||"")}`)
    },
    {
      id:"qr",
      name:{ru:"QR Code Generator", uk:"QR Code Generator", en:"QR Code Generator"},
      action:{ru:"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR", uk:"–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ QR", en:"Generate QR"},
      fields:[{k:"text", ph:{ru:"—Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Å—ã–ª–∫–∞", uk:"—Ç–µ–∫—Å—Ç –∞–±–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è", en:"text or link"}}],
      run: async (v)=> {
        const t = (v.text||"").trim();
        if(!t) throw new Error("Empty text");
        const url = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(t)}`;
        return { ok:true, qr_url: url };
      }
    },
    {
      id:"discord",
      name:{ru:"Discord Lookup (ID)", uk:"Discord Lookup (ID)", en:"Discord Lookup (ID)"},
      action:{ru:"–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å ID", uk:"–î–µ–∫–æ–¥—É–≤–∞—Ç–∏ ID", en:"Decode ID"},
      fields:[{k:"id", ph:{ru:"Discord ID (snowflake)", uk:"Discord ID (snowflake)", en:"Discord ID (snowflake)"}}],
      run: async (v)=> {
        const s = (v.id||"").trim();
        if(!/^\d{15,20}$/.test(s)) throw new Error("Invalid snowflake");
        const n = BigInt(s);
        const discordEpoch = 1420070400000n;
        const ts = Number((n >> 22n) + discordEpoch);
        return { ok:true, id:s, created_at_iso: new Date(ts).toISOString() };
      }
    },
    {
      id:"pass",
      name:{ru:"Password Generator", uk:"Password Generator", en:"Password Generator"},
      action:{ru:"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å", uk:"–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏", en:"Generate"},
      fields:[
        {k:"len", ph:{ru:"–¥–ª–∏–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 16)", uk:"–¥–æ–≤–∂–∏–Ω–∞ (–∑–∞ –∑–∞–º–æ–≤—á. 16)", en:"length (default 16)"}},
        {k:"count", ph:{ru:"—Å–∫–æ–ª—å–∫–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)", uk:"—Å–∫—ñ–ª—å–∫–∏ (–∑–∞ –∑–∞–º–æ–≤—á. 5)", en:"count (default 5)"}}
      ],
      run: async (v)=> {
        const L = Math.min(Math.max(parseInt(v.len||"16",10)||16, 8), 64);
        const C = Math.min(Math.max(parseInt(v.count||"5",10)||5, 1), 30);
        const chars = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%^&*_-+=";
        const out = [];
        for(let i=0;i<C;i++){
          const buf = new Uint32Array(L);
          crypto.getRandomValues(buf);
          let p = "";
          for(let j=0;j<L;j++) p += chars[buf[j] % chars.length];
          out.push(p);
        }
        return { ok:true, length:L, count:C, passwords: out };
      }
    },
    {
      id:"github",
      name:{ru:"GitHub Search", uk:"GitHub Search", en:"GitHub Search"},
      action:{ru:"–ò—Å–∫–∞—Ç—å", uk:"–®—É–∫–∞—Ç–∏", en:"Search"},
      fields:[
        {k:"q", ph:{ru:"–∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: nickname)", uk:"–∑–∞–ø–∏—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: nickname)", en:"query (e.g. nickname)"}}
      ],
      run: async (v)=> apiJson(`/api/github?q=${encodeURIComponent(v.q||"")}`)
    },
    {
      id:"subs",
      name:{ru:"Subdomain Finder", uk:"Subdomain Finder", en:"Subdomain Finder"},
      action:{ru:"–ù–∞–π—Ç–∏", uk:"–ó–Ω–∞–π—Ç–∏", en:"Find"},
      fields:[{k:"domain", ph:{ru:"example.com", uk:"example.com", en:"example.com"}}],
      run: async (v)=> apiJson(`/api/subdomains?domain=${encodeURIComponent(v.domain||"")}`)
    },
    {
      id:"port",
      name:{ru:"Port Scanner", uk:"Port Scanner", en:"Port Scanner"},
      action:{ru:"–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å", uk:"–°–∫–∞–Ω—É–≤–∞—Ç–∏", en:"Scan"},
      fields:[{k:"host", ph:{ru:"host", uk:"host", en:"host"}}],
      run: async (v)=> apiJson(`/api/port?host=${encodeURIComponent(v.host||"")}`)
    },
    {
      id:"proxy",
      name:{ru:"Proxy Checker", uk:"Proxy Checker", en:"Proxy Checker"},
      action:{ru:"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å", uk:"–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏", en:"Check"},
      fields:[{k:"proxy", ph:{ru:"ip:port", uk:"ip:port", en:"ip:port"}}],
      run: async (v)=> apiJson(`/api/proxy?proxy=${encodeURIComponent(v.proxy||"")}`)
    },
    // ========== –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò ==========
    {
      id:"dirbuster",
      name:{ru:"–ë—Ä—É—Ç—Ñ–æ—Ä—Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π/—Ñ–∞–π–ª–æ–≤", uk:"–ë—Ä—É—Ç—Ñ–æ—Ä—Å –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π/—Ñ–∞–π–ª—ñ–≤", en:"Directory/File Brute Forcer"},
      action:{ru:"–ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", uk:"–†–æ–∑–ø–æ—á–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è", en:"Start scanning"},
      fields:[
        {k:"url", ph:{ru:"https://example.com", uk:"https://example.com", en:"https://example.com"}},
        {k:"extensions", ph:{ru:"—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (php,html,asp) —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é", uk:"—Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è (php,html,asp) —á–µ—Ä–µ–∑ –∫–æ–º—É", en:"extensions (php,html,asp) comma separated"}}
      ],
      run: async (v)=> {
        const url = v.url?.trim();
        if(!url) throw new Error(tr({ru:"–í–≤–µ–¥–∏—Ç–µ URL", uk:"–í–≤–µ–¥—ñ—Ç—å URL", en:"Enter URL"}));
        const exts = v.extensions?.split(',').map(e=>e.trim()).filter(Boolean) || ['php','html','htm','asp','aspx','jsp','do','txt','bak','zip','tar.gz','sql'];
        return apiJson(`/api/dirbuster?url=${encodeURIComponent(url)}&exts=${encodeURIComponent(exts.join(','))}`);
      }
    },
    {
      id:"fakeid",
      name:{ru:"–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–µ–π–∫–æ–≤—ã—Ö –ª–∏—á–Ω–æ—Å—Ç–µ–π", uk:"–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–µ–π–∫–æ–≤–∏—Ö –æ—Å—ñ–±", en:"Fake Identity Generator"},
      action:{ru:"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å", uk:"–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏", en:"Generate"},
      fields:[
        {k:"country", ph:{ru:"–°—Ç—Ä–∞–Ω–∞ (ru/us)", uk:"–ö—Ä–∞—ó–Ω–∞ (ru/us)", en:"Country (ru/us)"}},
        {k:"count", ph:{ru:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (1-10)", uk:"–ö—ñ–ª—å–∫—ñ—Å—Ç—å (1-10)", en:"Count (1-10)"}}
      ],
      run: async (v)=> {
        const country = (v.country || 'ru').toLowerCase();
        if(!['ru','us'].includes(country)) throw new Error(tr({ru:"–°—Ç—Ä–∞–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ru –∏–ª–∏ us", uk:"–ö—Ä–∞—ó–Ω–∞ –º–∞—î –±—É—Ç–∏ ru –∞–±–æ us", en:"Country must be ru or us"}));
        const cnt = Math.min(parseInt(v.count) || 1, 10);
        return apiJson(`/api/fakeid?country=${country}&count=${cnt}`);
      }
    },
    {
      id:"deobfuscate",
      name:{ru:"–î–µ–æ–±—Ñ—É—Å–∫–∞—Ç–æ—Ä –∫–æ–¥–∞", uk:"–î–µ–æ–±—Ñ—É—Å–∫–∞—Ç–æ—Ä –∫–æ–¥—É", en:"Code Deobfuscator"},
      action:{ru:"–î–µ–æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞—Ç—å", uk:"–î–µ–æ–±—Ñ—É—Å–∫—É–≤–∞—Ç–∏", en:"Deobfuscate"},
      fields:[
        {k:"code", ph:{ru:"–∫–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏", uk:"–∫–æ–¥ –¥–ª—è –æ–±—Ä–æ–±–∫–∏", en:"code to process"}},
        {k:"mode", ph:{ru:"—Ä–µ–∂–∏–º (deobfuscate/obfuscate)", uk:"—Ä–µ–∂–∏–º (deobfuscate/obfuscate)", en:"mode (deobfuscate/obfuscate)"}},
        {k:"lang", ph:{ru:"—è–∑—ã–∫ (js/php/html)", uk:"–º–æ–≤–∞ (js/php/html)", en:"language (js/php/html)"}}
      ],
      run: async (v)=> {
        if(!v.code?.trim()) throw new Error(tr({ru:"–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥", uk:"–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥", en:"Enter code"}));
        const mode = v.mode || 'deobfuscate';
        const lang = v.lang || 'js';
        return apiJson(`/api/deobfuscate?mode=${mode}&lang=${lang}`, { code: v.code }, 'POST');
      }
    },
    {
      id:"metasploit",
      name:{ru:"–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä—É–∑–∫–∏ Metasploit", uk:"–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Metasploit", en:"Metasploit Payload Generator"},
      action:{ru:"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å", uk:"–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏", en:"Generate"},
      fields:[
        {k:"lhost", ph:{ru:"–≤–∞—à IP (LHOST)", uk:"–≤–∞—à IP (LHOST)", en:"your IP (LHOST)"}},
        {k:"lport", ph:{ru:"–ø–æ—Ä—Ç (LPORT)", uk:"–ø–æ—Ä—Ç (LPORT)", en:"port (LPORT)"}},
        {k:"platform", ph:{ru:"–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (windows/linux/android)", uk:"–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (windows/linux/android)", en:"platform (windows/linux/android)"}},
        {k:"payload_type", ph:{ru:"—Ç–∏–ø (reverse/shell/bind)", uk:"—Ç–∏–ø (reverse/shell/bind)", en:"type (reverse/shell/bind)"}}
      ],
      run: async (v)=> {
        if(!v.lhost?.trim()) throw new Error(tr({ru:"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à IP", uk:"–í–≤–µ–¥—ñ—Ç—å –≤–∞—à IP", en:"Enter your IP"}));
        if(!v.lport?.trim() || isNaN(parseInt(v.lport))) throw new Error(tr({ru:"–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ—Ä—Ç", uk:"–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –ø–æ—Ä—Ç", en:"Enter valid port"}));
        return apiJson(`/api/metasploit?lhost=${encodeURIComponent(v.lhost)}&lport=${encodeURIComponent(v.lport)}&platform=${encodeURIComponent(v.platform||'windows')}&type=${encodeURIComponent(v.payload_type||'reverse')}`);
      }
    }
  ];

  function tr(obj){
    if(!obj) return "";
    if(typeof obj === "string") return obj;
    return obj[LANG] || obj.ru || obj.en || "";
  }

  function applyLang(lang){
    LANG = (lang === "uk" || lang === "ru" || lang === "en") ? lang : "ru";
    document.documentElement.lang = LANG;
    gateTitle.textContent = UI[LANG].gateTitle;
    gateHint.textContent = UI[LANG].gateHint || "";
    brandTitle.textContent = UI[LANG].brandTitle;
    brandSub.textContent = UI[LANG].brandSub || "";
    btnHome.textContent = UI[LANG].close;
    gateLoadTitle.textContent = UI[LANG].loading;
    gateLoadHint.textContent = "";
  }

  function renderCards(){
    cardsEl.innerHTML = "";
    for(const t of tools){
      const d = document.createElement("div");
      d.className = "card";
      d.innerHTML = `<div class="name">${tr(t.name)}</div>`;
      d.onclick = ()=>openTool(t.id);
      cardsEl.appendChild(d);
    }
  }

  function openTool(id){
    current = tools.find(x=>x.id===id);
    if(!current) return;
    panelTitle.textContent = tr(current.name);
    btnRun.textContent = tr(current.action) || "Run";
    fieldsEl.innerHTML = "";
    outEl.textContent = "";

    for(const f of (current.fields || [])){
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
      const makeSegments = (() => {
        if (current.id === 'deobfuscate' && (f.k === 'mode' || f.k === 'lang')) return true;
        if (current.id === 'fakeid' && f.k === 'country') return true;
        if (current.id === 'metasploit' && (f.k === 'platform' || f.k === 'payload_type')) return true;
        return false;
      })();

      if (makeSegments) {
        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const segContainer = document.createElement('div');
        segContainer.className = 'fieldRow';
        
        const hidden = document.createElement('input');
        hidden.type = 'hidden';
        hidden.dataset.key = f.k;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—è
        let options = [];
        if (current.id === 'deobfuscate' && f.k === 'mode') {
          options = ['deobfuscate', 'obfuscate'];
        } else if (current.id === 'deobfuscate' && f.k === 'lang') {
          options = ['js', 'php', 'html'];
        } else if (current.id === 'fakeid' && f.k === 'country') {
          options = ['ru', 'us'];
        } else if (current.id === 'metasploit' && f.k === 'platform') {
          options = ['windows', 'linux', 'android'];
        } else if (current.id === 'metasploit' && f.k === 'payload_type') {
          options = ['reverse', 'shell', 'bind'];
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
        hidden.value = options[0];
        
        const seg = document.createElement('div');
        seg.className = 'seg';
        
        const buttons = [];
        options.forEach((opt, idx) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'segBtn' + (idx === 0 ? ' active' : '');
          btn.textContent = opt;
          btn.onclick = () => {
            hidden.value = opt;
            buttons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
          };
          seg.appendChild(btn);
          buttons.push(btn);
        });
        
        segContainer.appendChild(hidden);
        segContainer.appendChild(seg);
        fieldsEl.appendChild(segContainer);
        
      } else {
        // –û–±—ã—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
        const inp = document.createElement('input');
        inp.className = 'input';
        inp.placeholder = tr(f.ph) || f.k;
        inp.dataset.key = f.k;
        fieldsEl.appendChild(inp);
      }
    }

    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è GitHub (—É–∂–µ –µ—Å—Ç—å)
    if(current.id === "github"){
      const hid = document.createElement("input");
      hid.type = "hidden";
      hid.dataset.key = "type";
      hid.value = "users";
      fieldsEl.appendChild(hid);

      const seg = document.createElement("div");
      seg.className = "seg";

      const bUsers = document.createElement("button");
      bUsers.type = "button";
      bUsers.className = "segBtn active";
      bUsers.textContent = tr({ru:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", uk:"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ", en:"Users"});

      const bRepos = document.createElement("button");
      bRepos.type = "button";
      bRepos.className = "segBtn";
      bRepos.textContent = tr({ru:"–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏", uk:"–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó", en:"Repositories"});

      const setType = (t)=>{
        hid.value = t;
        if(t === "users"){
          bUsers.classList.add("active"); bRepos.classList.remove("active");
        }else{
          bRepos.classList.add("active"); bUsers.classList.remove("active");
        }
      };
      bUsers.onclick = ()=>setType("users");
      bRepos.onclick = ()=>setType("repositories");

      seg.appendChild(bUsers);
      seg.appendChild(bRepos);
      fieldsEl.appendChild(seg);
    }

    panel.classList.add("open");
    window.scrollTo({ top: panel.offsetTop - 8, behavior: "smooth" });
  }

  btnHome.onclick = ()=>{
    panel.classList.remove("open");
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è apiJson —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π POST
  async function apiJson(url, body, method = 'GET'){
    const ctrl = new AbortController();
    const timer = setTimeout(()=>ctrl.abort(), 15000);
    try{
      const options = {
        method,
        signal: ctrl.signal,
        headers: {}
      };
      if (body) {
        options.body = JSON.stringify(body);
        options.headers['Content-Type'] = 'application/json';
      }
      const r = await fetch(url, options);
      const ctype = (r.headers.get("content-type") || "").toLowerCase();
      let data = {};
      if(ctype.includes("application/json")){
        data = await r.json().catch(()=> ({}));
      }else{
        const txt = await r.text().catch(()=> "");
        data = { error: txt ? txt.slice(0, 200) : "" };
      }
      if(!r.ok) throw new Error(data.error || data.message || `HTTP ${r.status}`);
      return data;
    }catch(e){
      if(e && e.name === "AbortError") throw new Error("Timeout");
      throw e;
    }finally{
      clearTimeout(timer);
    }
  }

  
  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function isUrl(s){
    if(typeof s !== "string") return false;
    return /^https?:\/\/\S+$/i.test(s);
  }

  function pill(text, ok){
    const sp = document.createElement("span");
    sp.className = "pill " + (ok ? "ok" : "bad");
    sp.textContent = text;
    return sp;
  }

  function row(label, valueNodeOrText){
    const r = document.createElement("div");
    r.className = "row";
    const k = document.createElement("div");
    k.className = "k";
    k.textContent = label;
    const v = document.createElement("div");
    v.className = "v";
    if (valueNodeOrText instanceof Node) v.appendChild(valueNodeOrText);
    else v.textContent = valueNodeOrText == null ? "" : String(valueNodeOrText);
    r.appendChild(k); r.appendChild(v);
    return r;
  }

  function showRunning(){
    outEl.innerHTML = `<div class="loadingRow"><img class="loadingGif" alt="" data-asset="loading.gif"><div>${escapeHtml(UI[LANG].running)}</div></div>`;
    const img = outEl.querySelector("img.loadingGif");
    if(img) setAssetImg(img, "loading.gif");
  }

  function renderError(err){
    const msg = String(err?.message || err || UI[LANG].error);
    renderResult({ ok:false, error: msg });
  }

  function pick(obj, keys){
    const out = {};
    for(const k of keys){
      if(obj && obj[k] != null && obj[k] !== "") out[k] = obj[k];
    }
    return out;
  }

  function extractVCardEmails(entity){
    const vc = entity?.vcardArray;
    const rows = Array.isArray(vc) ? vc[1] : null;
    if(!Array.isArray(rows)) return [];
    const out = [];
    for(const r of rows){
      if(Array.isArray(r) && String(r[0]).toLowerCase() === "email"){
        const v = r[3];
        if(typeof v === "string" && v.trim()) out.push(v.trim());
      }
    }
    return out;
  }

  function extractRdapEmails(rdap){
    const ents = Array.isArray(rdap?.entities) ? rdap.entities : [];
    const out = [];
    for(const e of ents){
      const roles = Array.isArray(e?.roles) ? e.roles.map(x=>String(x).toLowerCase()) : [];
      const important = roles.some(r => ["abuse","noc","technical","administrative","registrant"].includes(r));
      if(!important) continue;
      out.push(...extractVCardEmails(e));
    }
    return Array.from(new Set(out));
  }

  function renderGenericKV(obj){
    const rows = document.createElement("div");
    rows.className = "rows";

    if(!obj || typeof obj !== "object"){
      rows.appendChild(row("result", obj));
      return rows;
    }

    const base = (obj && obj.data && typeof obj.data === "object") ? obj.data : obj;
    const keys = Object.keys(base).slice(0, 12);

    for(const k of keys){
      const val = base[k];
      if(val == null) continue;

      if(typeof val === "boolean"){
        const box = document.createElement("div");
        box.appendChild(pill(val ? "YES" : "NO", !!val));
        rows.appendChild(row(k, box));
        continue;
      }

      if(Array.isArray(val)){
        const list = document.createElement("div");
        list.className = "list";
        const show = val.slice(0, 25);
        for(const item of show){
          const it = document.createElement("div");
          it.className = "item";
          const code = document.createElement("div");
          code.className = "code";
          code.textContent = String(item);
          const btn = document.createElement("button");
          btn.className = "miniBtn";
          btn.type = "button";
          btn.textContent = UI[LANG].copy;
          btn.setAttribute("data-copy", String(item));
          it.appendChild(code);
          it.appendChild(btn);
          list.appendChild(it);
        }
        if(val.length > show.length){
          const more = document.createElement("div");
          more.style.color = "rgba(255,255,255,.55)";
          more.textContent = `+${val.length - show.length} more`;
          list.appendChild(more);
        }
        rows.appendChild(row(k, list));
        continue;
      }

      if(typeof val === "object"){
        rows.appendChild(row(k, "[object]"));
        continue;
      }

      if(isUrl(String(val))){
        const a = document.createElement("a");
        a.href = String(val); a.target="_blank"; a.rel="noreferrer";
        a.textContent = String(val);
        rows.appendChild(row(k, a));
        continue;
      }

      rows.appendChild(row(k, String(val)));
    }
    return rows;
  }

  function renderHeaders(data){
    const base = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";
    rows.appendChild(row("url", base.url || ""));
    if(base.status != null) rows.appendChild(row("status", String(base.status)));

    const headers = base.headers || {};
    const table = document.createElement("table");
    table.className = "kv";
    for(const k of Object.keys(headers)){
      const tr = document.createElement("tr");
      const td1 = document.createElement("td"); td1.textContent = k;
      const td2 = document.createElement("td"); td2.textContent = headers[k];
      tr.appendChild(td1); tr.appendChild(td2);
      table.appendChild(tr);
    }
    rows.appendChild(row("headers", table));
    return rows;
  }

  function renderEmail(data){
    const d = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";

    const syntaxOk = !!d.valid_syntax;
    const mxFound = d.mx_found === true || d.deliverable === true;
    const domainExists = d.domain_exists === true || mxFound;
    const disposable = d.disposable === true;

    rows.appendChild(row("email", d.email_address || d.email || ""));
    if(d.domain) rows.appendChild(row("domain", d.domain));

    const flags = document.createElement("div");
    flags.appendChild(pill("SYNTAX " + (syntaxOk ? "OK" : "BAD"), syntaxOk));
    flags.appendChild(pill("DOMAIN " + (domainExists ? "YES" : "NO"), domainExists));
    flags.appendChild(pill("MX " + (mxFound ? "YES" : "NO"), mxFound));
    if(d.disposable != null) flags.appendChild(pill("DISPOSABLE " + (disposable ? "YES" : "NO"), !disposable));
    rows.appendChild(row("check", flags));

    if(d.suggestion){
      rows.appendChild(row("suggestion", d.suggestion));
    }

    const mx = Array.isArray(d.mx_records) ? d.mx_records : [];
    if(mx.length){
      const list = document.createElement("div");
      list.className = "list";
      for(const rec of mx.slice(0, 20)){
        const line = document.createElement("div");
        line.className = "item";
        const left = document.createElement("div");
        left.className = "code";
        left.textContent = `${rec.preference}  ${rec.exchange}`;
        line.appendChild(left);
        list.appendChild(line);
      }
      rows.appendChild(row("mx_records", list));
    }

    return rows;
  }

  function renderWhois(data){
    const rdap = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";

    const name = rdap?.ldhName || rdap?.unicodeName || "";
    if(name) rows.appendChild(row("domain", name));

    if(Array.isArray(rdap?.status) && rdap.status.length){
      rows.appendChild(row("status", rdap.status.join(", ")));
    }

    const ev = Array.isArray(rdap?.events) ? rdap.events : [];
    const wanted = ["registration", "expiration", "last changed", "last update of rdap database"];
    for(const w of wanted){
      const e = ev.find(x => (x?.eventAction||"").toLowerCase() === w);
      if(e && e.eventDate) rows.appendChild(row(w, e.eventDate));
    }

    return rows;
  }

  function renderGithub(data){
    const d = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";

    if(d.total_count != null) rows.appendChild(row("total", String(d.total_count)));

    const items = Array.isArray(d.items) ? d.items.slice(0, 20) : [];
    const list = document.createElement("div");
    list.className = "list";

    for(const it of items){
      const line = document.createElement("div");
      line.className = "item";
      const left = document.createElement("div");
      left.className = "code";

      const url = it.html_url || it.url;
      const title = it.full_name || it.login || it.name || "item";
      if(url){
        const a = document.createElement("a");
        a.href = url; a.target="_blank"; a.rel="noreferrer";
        a.textContent = title;
        left.appendChild(a);
      }else{
        left.textContent = title;
      }

      const btn = document.createElement("button");
      btn.className = "miniBtn";
      btn.type = "button";
      btn.textContent = UI[LANG].copy;
      btn.setAttribute("data-copy", url || title);

      line.appendChild(left);
      line.appendChild(btn);
      list.appendChild(line);
    }

    rows.appendChild(row("results", list));
    return rows;
  }

  function renderPasswords(data){
    const d = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";
    const arr = d.passwords || [];
    const list = document.createElement("div");
    list.className = "list";
    for(const p of arr){
      const line = document.createElement("div");
      line.className = "item";
      const code = document.createElement("div");
      code.className = "code";
      code.textContent = p;
      const btn = document.createElement("button");
      btn.className = "miniBtn";
      btn.type = "button";
      btn.textContent = UI[LANG].copy;
      btn.setAttribute("data-copy", p);
      line.appendChild(code);
      line.appendChild(btn);
      list.appendChild(line);
    }
    rows.appendChild(row("passwords", list));
    return rows;
  }

  function renderSubdomains(data){
    const d = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";
    if(d.domain) rows.appendChild(row("domain", d.domain));
    if(d.count != null) rows.appendChild(row("count", String(d.count)));
    if(Array.isArray(d.subdomains)){
      const list = document.createElement("div");
      list.className = "list";
      for(const s of d.subdomains.slice(0, 250)){
        const line = document.createElement("div");
        line.className = "item";
        const code = document.createElement("div"); code.className="code"; code.textContent = s;
        const btn = document.createElement("button");
        btn.className="miniBtn"; btn.type="button"; btn.textContent = UI[LANG].copy;
        btn.setAttribute("data-copy", s);
        line.appendChild(code); line.appendChild(btn);
        list.appendChild(line);
      }
      rows.appendChild(row("subdomains", list));
    }
    return rows;
  }

  function renderIP(data){
    const root = (data && typeof data === "object") ? data : {};
    const d = root?.data ? root.data : root;
    const mapUrl = root?.map || d?.map || "";
    const rows = document.createElement("div");
    rows.className = "rows";

    const meta = (d && typeof d._meta === "object" && d._meta) ? d._meta : {};
    const rdap = (d && typeof d._rdap === "object" && d._rdap) ? d._rdap : null;
    const ip = d?.ip || meta?.ip || "";

    // --- Pretty top block ---
    rows.appendChild(row("IP Address", ip));

    const cc = d?.country_code ? String(d.country_code) : (d?.countryCode ? String(d.countryCode) : "");
    const countryName = d?.country ? String(d.country) : (d?.country_name ? String(d.country_name) : "");
    if(countryName){
      rows.appendChild(row("Country", cc ? `${countryName} [${cc}]` : countryName));
    }

    const regionName = d?.region ? String(d.region) : "";
    const regionCode = d?.region_code ? String(d.region_code) : (d?.region_code ? String(d.region_code) : "");
    if(regionName){
      rows.appendChild(row("Region", regionCode ? `${regionName} (${regionCode})` : regionName));
    }

    const city = d?.city ? String(d.city) : "";
    const postal = d?.postal ? String(d.postal) : (d?.zip ? String(d.zip) : "");
    if(city){
      rows.appendChild(row("City", postal ? `${city} (${postal})` : city));
    }else if(postal){
      rows.appendChild(row("City", `(${postal})`));
    }

    const tz = d?.timezone ? String(d.timezone) : (d?.timezone_id ? String(d.timezone_id) : "");
    if(tz) rows.appendChild(row("Timezone", tz));

    const isp = d?.isp ? String(d.isp) : (d?.connection?.isp ? String(d.connection.isp) : "");
    if(isp) rows.appendChild(row("ISP", isp));

    const org = d?.organization ? String(d.organization) : (d?.org ? String(d.org) : (d?.connection?.org ? String(d.connection.org) : ""));
    if(org) rows.appendChild(row("Organization", org));

    const asnNum = (d?.as_number != null) ? String(d.as_number) : (d?.asn != null ? String(d.asn) : "");
    rows.appendChild(row("AS Number", asnNum || "‚Äî"));

    const lat = (d?.latitude != null) ? d.latitude : d?.lat;
    const lon = (d?.longitude != null) ? d.longitude : d?.lon;
    if(lat != null && lon != null) rows.appendChild(row("Coordinates", `${lat}, ${lon}`));

    if(mapUrl){
      const a = document.createElement("a");
      a.href = mapUrl;
      a.target = "_blank";
      a.rel = "noopener";
      a.textContent = mapUrl;
      rows.appendChild(row("Map", a));
    }

    // Tech bits
    const rev = d?._ptr || d?.reverse || "";
    if(rev) rows.appendChild(row("Reverse DNS", rev));
    if(meta.ip_version) rows.appendChild(row("IP Version", String(meta.ip_version)));
    if(meta.fetched_at_iso) rows.appendChild(row("Fetched At", meta.fetched_at_iso));

    // Flags
    const flags = document.createElement("div");
    const flagItems = [
      { label:"PRIVATE", value: meta.is_private, goodWhenFalse:true },
      { label:"LOOPBACK", value: meta.is_loopback, goodWhenFalse:true },
      { label:"LINK_LOCAL", value: meta.is_link_local, goodWhenFalse:true },
      { label:"CGNAT", value: meta.is_cgnat, goodWhenFalse:true },
      { label:"MULTICAST", value: meta.is_multicast, goodWhenFalse:true },
      { label:"RESERVED", value: meta.is_reserved, goodWhenFalse:true },
    ];
    for(const it of flagItems){
      if(it.value == null) continue;
      const yes = !!it.value;
      const ok = it.goodWhenFalse ? !yes : yes;
      flags.appendChild(pill(`${it.label} ${yes ? "YES" : "NO"}`, ok));
    }
    if(flags.childNodes.length) rows.appendChild(row("flags", flags));

    // Extra hints
    if(d.mobile != null || d.proxy != null || d.hosting != null){
      const sec = document.createElement("div");
      if(d.mobile != null) sec.appendChild(pill(`MOBILE ${d.mobile ? "YES" : "NO"}`, true));
      if(d.proxy != null) sec.appendChild(pill(`PROXY ${d.proxy ? "YES" : "NO"}`, !d.proxy));
      if(d.hosting != null) sec.appendChild(pill(`HOSTING ${d.hosting ? "YES" : "NO"}`, !d.hosting));
      if(sec.childNodes.length) rows.appendChild(row("Hints", sec));
    }

    if(d.as_text) rows.appendChild(row("AS", d.as_text));
    if(d.reverse && !rev) rows.appendChild(row("Reverse", d.reverse));

    // RDAP enrichment
    if(rdap){
      const rdTitle = document.createElement("div");
      rdTitle.style.marginTop = "6px";
      rdTitle.style.color = "rgba(255,255,255,.72)";
      rdTitle.style.fontSize = "11px";
      rdTitle.style.textTransform = "uppercase";
      rdTitle.style.letterSpacing = ".6px";
      rdTitle.textContent = "RDAP";
      rows.appendChild(rdTitle);

      const rdPick = ["name","type","handle","startAddress","endAddress","ipVersion","country","parentHandle"];
      const rd = pick(rdap, rdPick);
      for(const k of Object.keys(rd)) rows.appendChild(row("rdap_"+k, String(rd[k])));

      if(Array.isArray(rdap.cidr0_cidrs) && rdap.cidr0_cidrs.length){
        const cidrs = rdap.cidr0_cidrs
          .map(x => {
            const p = x?.v4prefix || x?.v6prefix;
            const len = x?.length;
            return (p && (len != null)) ? `${p}/${len}` : null;
          })
          .filter(Boolean);
        if(cidrs.length) rows.appendChild(row("rdap_cidrs", cidrs.join(", ")));
      }

      const emails = extractRdapEmails(rdap);
      if(emails.length){
        const list = document.createElement("div");
        list.className = "list";
        for(const em of emails.slice(0, 40)){
          const line = document.createElement("div");
          line.className = "item";
          const code = document.createElement("div"); code.className = "code"; code.textContent = em;
          const btn = document.createElement("button");
          btn.className = "miniBtn"; btn.type = "button"; btn.textContent = UI[LANG].copy;
          btn.setAttribute("data-copy", em);
          line.appendChild(code); line.appendChild(btn);
          list.appendChild(line);
        }
        rows.appendChild(row("rdap_emails", list));
      }
    }

    const det = document.createElement("details");
    det.className = "raw";
    const sum = document.createElement("summary");
    sum.textContent = (LANG === "ru") ? "–í—Å–µ –ø–æ–ª—è" : (LANG === "uk" ? "–£—Å—ñ –ø–æ–ª—è" : "All fields");
    const table = document.createElement("table");
    table.className = "kv";

    const keys = Object.keys(d || {}).filter(k => !k.startsWith("_"));
    keys.sort();
    for(const k of keys){
      const val = d[k];
      if(val == null || val === "") continue;
      const trEl = document.createElement("tr");
      const td1 = document.createElement("td"); td1.textContent = k;
      const td2 = document.createElement("td");
      if(typeof val === "object"){
        const pre = document.createElement("pre");
        pre.style.margin = "0";
        pre.style.whiteSpace = "pre-wrap";
        pre.textContent = JSON.stringify(val, null, 2);
        td2.appendChild(pre);
      }else{
        td2.textContent = String(val);
      }
      trEl.appendChild(td1); trEl.appendChild(td2);
      table.appendChild(trEl);
    }
    det.appendChild(sum);
    det.appendChild(table);
    rows.appendChild(det);

    return rows;
  }

  function renderDiscord(data){
    const d = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";
    rows.appendChild(row("id", d.id || ""));
    rows.appendChild(row("created_at", d.created_at_iso || ""));
    return rows;
  }

  // ===== –†–ï–ù–î–ï–†–ï–† –î–õ–Ø –ì–ï–ù–ï–†–ê–¢–û–†–ê –§–ï–ô–ö–û–í–´–• –õ–ò–ß–ù–û–°–¢–ï–ô =====
  function renderFakeid(data){
    const d = data?.data ? data.data : data;
    const rows = document.createElement("div");
    rows.className = "rows";

    if(!Array.isArray(d)){
      rows.appendChild(row("error", "Invalid data format"));
      return rows;
    }

    for(let i = 0; i < d.length; i++){
      const identity = d[i];
      const box = document.createElement("div");
      box.style.border = "1px solid rgba(255,255,255,.2)";
      box.style.padding = "10px";
      box.style.marginBottom = "10px";
      box.style.background = "rgba(0,0,0,.3)";

      const title = document.createElement("div");
      title.style.fontSize = "13px";
      title.style.fontWeight = "bold";
      title.style.marginBottom = "8px";
      title.style.textTransform = "uppercase";
      title.style.letterSpacing = "0.5px";
      title.textContent = `üë§ –õ–∏—á–Ω–æ—Å—Ç—å #${i+1}`;
      box.appendChild(title);

      const addRow = (label, val) => {
        if(val == null || val === "") return;
        const r = document.createElement("div");
        r.style.display = "flex";
        r.style.gap = "10px";
        r.style.padding = "4px 0";
        r.style.borderBottom = "1px solid rgba(255,255,255,.1)";
        const k = document.createElement("div");
        k.style.minWidth = "120px";
        k.style.color = "rgba(255,255,255,.55)";
        k.style.fontSize = "11px";
        k.style.textTransform = "uppercase";
        k.textContent = label;
        const v = document.createElement("div");
        v.style.fontSize = "12px";
        v.style.color = "#fff";
        v.textContent = val;
        r.appendChild(k); r.appendChild(v);
        box.appendChild(r);
      };

      addRow("Full Name", identity.fullName);
      addRow("Gender", identity.gender);
      addRow("Birth Date", identity.birthDate);
      if(identity.address){
        const addr = `${identity.address.city}, ${identity.address.street}, ${identity.address.zip}`;
        addRow("Address", addr);
      }
      addRow("Phone", identity.phone);
      addRow("Email", identity.email);
      if(identity.creditCard){
        addRow("Card", `${identity.creditCard.type} ${identity.creditCard.number}`);
        addRow("Card CVV", identity.creditCard.cvv);
        addRow("Card Expiry", identity.creditCard.expiry);
      }
      addRow("Password", identity.password);
      addRow("Country", identity.country);

      rows.appendChild(box);
    }
    return rows;
  }

  function renderResult(data){
    outEl.innerHTML = "";

    const box = document.createElement("div");
    box.className = "resultBox";

    const ok = (data && data.ok === true);
    const top = document.createElement("div");
    top.className = "resultTop";

    const b = document.createElement("span");
    b.className = "badge " + (ok ? "ok" : "bad");
    b.textContent = ok ? UI[LANG].success : UI[LANG].fail;

    const t = document.createElement("span");
    t.className = "resultTool";
    t.textContent = current ? tr(current.name) : "Result";

    top.appendChild(b);
    top.appendChild(t);
    box.appendChild(top);

    if (data && data.qr_url){
      const img = document.createElement("img");
      img.className = "qr";
      img.src = data.qr_url;
      img.alt = "QR";
      img.loading = "lazy";
      box.appendChild(img);
    }

    if (data && data.map){
      const a = document.createElement("a");
      a.href = data.map; a.target="_blank"; a.rel="noreferrer";
      a.textContent = UI[LANG].openMap;
      box.appendChild(a);
      box.appendChild(document.createElement("div"));
      box.appendChild(document.createElement("div"));
    }

    const body = document.createElement("div");
    body.className = "resultBody";

    if(!ok){
      body.appendChild(row("message", data?.error || UI[LANG].error));
      box.appendChild(body);
    } else {
      let view = null;
      const id = current?.id || "";
      if(id === "headers") view = renderHeaders(data);
      else if(id === "email") view = renderEmail(data);
      else if(id === "whois") view = renderWhois(data);
      else if(id === "github") view = renderGithub(data);
      else if(id === "pass") view = renderPasswords(data);
      else if(id === "subs") view = renderSubdomains(data);
      else if(id === "ip" || id === "geo") view = renderIP(data);
      else if(id === "discord") view = renderDiscord(data);
      else if(id === "fakeid") view = renderFakeid(data);
      else view = renderGenericKV(data);

      body.appendChild(view);
      box.appendChild(body);
    }

    const det = document.createElement("details");
    det.className = "raw";
    const sum = document.createElement("summary");
    sum.textContent = UI[LANG].raw;
    const pre = document.createElement("pre");
    pre.innerHTML = escapeHtml(JSON.stringify(data, null, 2));
    det.appendChild(sum);
    det.appendChild(pre);
    box.appendChild(det);

    outEl.appendChild(box);
  }

  // Copy buttons (event delegation)
  outEl.addEventListener("click", async (e)=>{
    const btn = e.target.closest("[data-copy]");
    if(!btn) return;
    const txt = btn.getAttribute("data-copy") || "";
    try{
      await navigator.clipboard.writeText(txt);
      const old = btn.textContent;
      btn.textContent = UI[LANG].copied;
      setTimeout(()=>{ btn.textContent = old; }, 900);
    }catch{
      // ignore
    }
  });


  btnRun.onclick = async ()=>{
    if(!current) return;
    const values = {};
    fieldsEl.querySelectorAll("input").forEach(i=>values[i.dataset.key]=i.value);
    showRunning();
    btnRun.disabled = true;
    try{
      const data = await current.run(values);
      renderResult(data);
    }catch(e){
      renderError(e);
    }finally{
      btnRun.disabled = false;
    }
  };

  
  function startApp(lang){
    applyLang(lang);
    gate.classList.add("hidden");
    wrap.classList.remove("hidden");
    renderCards();
  }

  function chooseLang(lang){
    applyLang(lang);
    gatePick.classList.add("hidden");
    gateLoad.classList.remove("hidden");
    requestAnimationFrame(()=>requestAnimationFrame(()=>setTimeout(()=>startApp(lang), 5000)));
  }

  window.addEventListener("load", ()=>{
    document.querySelectorAll("img[data-asset]").forEach(img=>{
      const name = img.getAttribute("data-asset");
      if(name) setAssetImg(img, name);
    });

    gate.classList.remove("hidden");
    gatePick.classList.remove("hidden");
    gateLoad.classList.add("hidden");

    document.querySelectorAll(".langBtn").forEach(btn=>{
      btn.addEventListener("click", ()=> chooseLang(btn.dataset.lang));
    });

    applyLang("ru");
  });
</script>
</body>
</html>
